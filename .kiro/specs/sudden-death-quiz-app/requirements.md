# 要件書

## 概要

グループ会社の忘年会イベント（想定参加者200人）で使用するサドンデス勝ち上がり式クイズアプリケーション。参加者はWebブラウザ（スマホ/PC）で参加し、AI生成されたクイズ問題に回答。正解者のみが次のラウンドに進出し、敗者復活戦も実装する。

## 要件

### 要件1：参加者のクイズ参加機能

**ユーザーストーリー:** 参加者として、Webブラウザからクイズに参加し、問題に回答できるようにしたい。そうすることで、忘年会イベントを楽しむことができる。

#### 受入基準

1. WHEN 参加者がWebブラウザでアプリにアクセスした時 THEN システムは匿名ログインまたは簡単な認証でログインできるようにする
2. WHEN 参加者がクイズセッションに参加した時 THEN システムは参加者を現在のラウンドに登録する
3. WHEN クイズ問題が表示された時 THEN システムは制限時間内に選択肢から回答を選択できるUIを提供する
4. WHEN 参加者が回答を送信した時 THEN システムは即座に正解・不正解を判定し結果を表示する
5. WHEN 参加者が不正解した時 THEN システムは参加者をそのラウンドから脱落させる

### 要件2：サドンデス形式のクイズ進行

**ユーザーストーリー:** 管理者として、サドンデス形式でクイズを進行し、正解者のみを次のラウンドに進出させたい。そうすることで、盛り上がるクイズイベントを運営できる。

#### 受入基準

1. WHEN 新しいラウンドが開始された時 THEN システムは現在の参加者全員に問題を配信する
2. WHEN 参加者が回答を提出した時 THEN システムは正解者と不正解者を即座に分類する
3. WHEN 回答時間が終了した時 THEN システムは正解者のみを次のラウンドに進出させる
4. WHEN 参加者が1人になるまで THEN システムはラウンドを継続する
5. IF 最終的に勝者が決定した時 THEN システムは勝者を表示し結果を記録する

### 要件3：AI問題生成機能

**ユーザーストーリー:** 管理者として、AIを使って動的にクイズ問題を生成したい。そうすることで、事前準備の手間を削減し、多様な問題を提供できる。

#### 受入基準

1. WHEN 新しい問題が必要な時 THEN システムはGemini APIを使用して問題を生成する
2. IF Gemini APIが利用できない時 THEN システムは自動的にOpenAIやClaude等の代替APIに切り替える
3. WHEN 問題を生成する時 THEN システムは4択形式の問題と正解を含むデータを作成する
4. WHEN 問題を生成する時 THEN システムは適切な難易度と多様なジャンルの問題を提供する
5. WHEN API制限に達した時 THEN システムは適切なエラーハンドリングを行い代替手段を実行する

### 要件4：敗者復活戦機能

**ユーザーストーリー:** 管理者として、脱落した参加者に敗者復活の機会を提供したい。そうすることで、より多くの参加者がイベントを楽しめる。

#### 受入基準

1. WHEN 管理者が敗者復活戦を開始した時 THEN システムは脱落した参加者の中からランダムに復活者を選出する
2. WHEN 敗者復活戦が実行された時 THEN システムは復活した参加者を現在のラウンドに再参加させる
3. WHEN 復活者が選出された時 THEN システムは復活者と他の参加者に通知を送信する
4. IF 復活戦の条件が設定されている時 THEN システムは設定に従って復活者数や条件を適用する

### 要件5：管理者向け操作機能

**ユーザーストーリー:** 管理者として、クイズの進行を制御し、参加者の状況を把握したい。そうすることで、スムーズなイベント運営ができる。

#### 受入基準

1. WHEN 管理者がダッシュボードにアクセスした時 THEN システムは現在の参加者数、ラウンド状況、勝ち残り者を表示する
2. WHEN 管理者が問題をスキップしたい時 THEN システムは現在の問題を終了し次の問題に進む
3. WHEN 管理者が結果を確認したい時 THEN システムは各ラウンドの結果と最終成績を表示する
4. WHEN 管理者がユーザーを管理したい時 THEN システムはCSV一括登録、個別登録・削除・編集機能を提供する
5. WHEN 管理者がクイズセッションを制御したい時 THEN システムは開始・一時停止・終了の操作を提供する

### 要件6：リアルタイム通信とパフォーマンス

**ユーザーストーリー:** 参加者として、リアルタイムでクイズの進行状況を把握し、快適に参加したい。そうすることで、ストレスなくイベントを楽しめる。

#### 受入基準

1. WHEN 新しい問題が配信された時 THEN システムは全参加者に即座に問題を表示する
2. WHEN 他の参加者が回答した時 THEN システムはリアルタイムで参加者数の変化を表示する
3. WHEN 200人が同時にアクセスした時 THEN システムは安定したパフォーマンスを維持する
4. WHEN ネットワーク接続が不安定な時 THEN システムは適切な再接続処理を行う
5. WHEN モバイルデバイスからアクセスした時 THEN システムはレスポンシブなUIを提供する

### 要件7：データ管理と分析

**ユーザーストーリー:** 管理者として、イベントの結果を記録し、後で分析できるようにしたい。そうすることで、次回のイベント改善に活用できる。

#### 受入基準

1. WHEN クイズが実行された時 THEN システムは全ての回答履歴をFirestoreに記録する
2. WHEN イベントが終了した時 THEN システムは参加者の成績と統計情報を保存する
3. WHEN 管理者が結果をエクスポートしたい時 THEN システムはCSV形式でデータをダウンロード可能にする
4. WHEN データを分析したい時 THEN システムは参加者数、正解率、ラウンド別統計を提供する
5. WHEN 個人情報を扱う時 THEN システムは適切なプライバシー保護措置を実装する