# 要件書

## 概要

グループ会社の忘年会イベント（想定参加者200人）で使用するサドンデス勝ち上がり式クイズアプリケーション。参加者はWebブラウザ（スマホ/PC）で参加し、AI生成されたクイズ問題に回答。正解者のみが次のラウンドに進出し、敗者復活戦も実装する。

## 要件

### 要件1：アクセスコード認証とユーザーログイン機能

**ユーザーストーリー:** 参加者として、共通のアクセスコードを入力してログイン画面に遷移し、管理者が登録したユーザー名・パスワードでログインしてクイズに参加したい。そうすることで、忘年会イベントを楽しむことができる。

#### 受入基準

1. WHEN 参加者がWebブラウザでアプリにアクセスした時 THEN システムはアクセスコード入力画面を表示する
2. WHEN 参加者が有効なアクセスコード（全員共通）を入力した時 THEN システムはログイン画面に遷移させる
3. WHEN 参加者が無効なアクセスコードを入力した時 THEN システムはエラーメッセージを表示し再入力を促す
4. WHEN 参加者がログイン画面でユーザー名・パスワードを入力した時 THEN システムは管理者が登録したユーザー情報と照合する
5. WHEN 認証が成功した時 THEN システムは参加可能なゲーム一覧を表示する
6. WHEN 認証が失敗した時 THEN システムはエラーメッセージを表示し再入力を促す
7. WHEN 参加者がゲームを選択した時 THEN システムは参加者をそのゲームセッションに登録する
8. WHEN クイズ問題が表示された時 THEN システムは制限時間内に選択肢から回答を選択できるUIを提供する
9. WHEN 参加者が回答を送信した時 THEN システムは即座に正解・不正解を判定し結果を表示する

### 要件2：ゲーム作成と管理機能

**ユーザーストーリー:** 管理者として、ゲームを作成し、参加者が参加できるゲームセッションを管理したい。そうすることで、計画的にクイズイベントを運営できる。

#### 受入基準

1. WHEN 管理者がログインした時 THEN システムは管理画面へのアクセスを許可する
2. WHEN 管理者がゲームを作成した時 THEN システムは新しいゲームセッションを作成し、初期問題10問を生成する
3. WHEN ゲームが開始された時 THEN システムは参加者がゲームに参加できる状態にする
4. WHEN 10問すべてに正解した参加者がいる時 THEN システムは追加で10問を自動生成する
5. WHEN ゲームが終了した時 THEN システムは勝者を確定し、そのゲームへの新規参加を停止する

### 要件3：サドンデス形式のクイズ進行

**ユーザーストーリー:** 参加者として、サドンデス形式でクイズに挑戦し、正解し続けることで勝利を目指したい。そうすることで、緊張感のあるクイズゲームを楽しめる。

#### 受入基準

1. WHEN 新しいラウンドが開始された時 THEN システムは現在の参加者全員に問題を配信する
2. WHEN 参加者が回答を提出した時 THEN システムは正解者と不正解者を即座に分類する
3. WHEN 参加者が不正解した時 THEN システムはその参加者をゲームから脱落させる
4. WHEN 参加者が10問連続正解した時 THEN システムは追加で10問を生成し、ゲームを継続する
5. WHEN 参加者が1人になるまたは全員脱落した時 THEN システムはゲームを終了し勝者を決定する

### 要件4：AI問題生成機能

**ユーザーストーリー:** システムとして、AIを使って動的にクイズ問題を生成したい。そうすることで、事前準備の手間を削減し、多様な問題を提供できる。

#### 受入基準

1. WHEN ゲームが作成された時 THEN システムはGemini APIを使用して初期問題10問を生成する
2. WHEN 10問連続正解者が出現した時 THEN システムは追加で10問を自動生成する
3. IF Gemini APIが利用できない時 THEN システムは自動的にOpenAIやClaude等の代替APIに切り替える
4. WHEN 問題を生成する時 THEN システムは4択形式の問題と正解を含むデータを作成する
5. WHEN API制限に達した時 THEN システムは適切なエラーハンドリングを行い代替手段を実行する

### 要件5：敗者復活戦機能

**ユーザーストーリー:** 脱落した参加者として、管理者が開始する敗者復活戦に参加して再チャレンジしたい。そうすることで、再びゲームを楽しむ機会を得られる。

#### 受入基準

1. WHEN 管理者が敗者復活戦を開始した時 THEN システムは脱落した参加者のみに復活戦参加の通知を送信する
2. WHEN 脱落した参加者が復活戦に参加した時 THEN システムは復活戦用の問題を配信する
3. WHEN 勝者（ゲームクリア済み）が復活戦に参加しようとした時 THEN システムは参加を拒否する
4. WHEN 復活戦で正解した参加者がいる時 THEN システムは復活者を現在進行中のゲームに再参加させる
5. WHEN 復活者が決定した時 THEN システムは復活者と他の参加者に通知を送信する

### 要件6：管理者向け操作機能

**ユーザーストーリー:** 管理者として、クイズの進行を制御し、参加者の状況を把握したい。そうすることで、スムーズなイベント運営ができる。

#### 受入基準

1. WHEN 管理者がダッシュボードにアクセスした時 THEN システムは現在の参加者数、ラウンド状況、勝ち残り者を表示する
2. WHEN 管理者が問題をスキップしたい時 THEN システムは現在の問題を終了し次の問題に進む
3. WHEN 管理者が結果を確認したい時 THEN システムは各ラウンドの結果と最終成績を表示する
4. WHEN 管理者がユーザーを管理したい時 THEN システムはユーザー名・パスワードのCSV一括登録、個別登録・削除・編集機能を提供する
5. WHEN 管理者がクイズセッションを制御したい時 THEN システムは開始・一時停止・終了の操作を提供する
6. WHEN 管理者がユーザーを登録した時 THEN システムはユーザー名・パスワード・表示名の組み合わせを保存する

### 要件7：リアルタイム通信とパフォーマンス

**ユーザーストーリー:** 参加者として、リアルタイムでクイズの進行状況を把握し、快適に参加したい。そうすることで、ストレスなくイベントを楽しめる。

#### 受入基準

1. WHEN 新しい問題が配信された時 THEN システムは全参加者に即座に問題を表示する
2. WHEN 他の参加者が回答した時 THEN システムはリアルタイムで参加者数の変化を表示する
3. WHEN 200人が同時にアクセスした時 THEN システムは安定したパフォーマンスを維持する
4. WHEN ネットワーク接続が不安定な時 THEN システムは適切な再接続処理を行う
5. WHEN モバイルデバイスからアクセスした時 THEN システムはレスポンシブなUIを提供する

### 要件8：アクセスコードとユーザー管理機能

**ユーザーストーリー:** 管理者として、参加者のアクセスを制御するための共通アクセスコードと、個別のユーザー認証情報を管理したい。そうすることで、適切な参加者管理ができる。

#### 受入基準

1. WHEN システムが起動した時 THEN システムはテキストファイルから共通アクセスコードを読み込む
2. WHEN 参加者がアクセスコードを入力した時 THEN システムは共通アクセスコードと照合する
3. WHEN 管理者がユーザー情報を登録した時 THEN システムはユーザー名・パスワード・表示名をデータベースに保存する
4. WHEN 参加者がログイン情報を入力した時 THEN システムは登録されたユーザー情報と照合する
5. WHEN 管理者がユーザー情報をCSVで一括登録した時 THEN システムは全ユーザー情報を一括でデータベースに保存する
6. WHEN 認証に失敗した時 THEN システムはログイン試行をログに記録する

### 要件9：データ管理と分析

**ユーザーストーリー:** 管理者として、イベントの結果を記録し、後で分析できるようにしたい。そうすることで、次回のイベント改善に活用できる。

#### 受入基準

1. WHEN クイズが実行された時 THEN システムは全ての回答履歴をFirestoreに記録する
2. WHEN イベントが終了した時 THEN システムは参加者の成績と統計情報を保存する
3. WHEN 管理者が結果をエクスポートしたい時 THEN システムはCSV形式でデータをダウンロード可能にする
4. WHEN データを分析したい時 THEN システムは参加者数、正解率、ラウンド別統計を提供する
5. WHEN 個人情報を扱う時 THEN システムは適切なプライバシー保護措置を実装する